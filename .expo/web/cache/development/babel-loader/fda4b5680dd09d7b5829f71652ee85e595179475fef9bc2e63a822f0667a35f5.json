{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nexport const loadWishlist = createAsyncThunk('wishlist/load', async userId => {\n  try {\n    const key = `@elearning_wishlist_${userId || 'guest'}`;\n    const raw = await AsyncStorage.getItem(key);\n    return raw ? JSON.parse(raw) : [];\n  } catch (e) {\n    return [];\n  }\n});\nconst wishlistSlice = createSlice({\n  name: 'wishlist',\n  initialState: {\n    items: []\n  },\n  reducers: {\n    setWishlist(state, action) {\n      state.items = action.payload || [];\n    },\n    addToWishlistLocal(state, action) {\n      const {\n        id\n      } = action.payload || {};\n      if (id && !state.items.includes(id)) {\n        state.items.push(id);\n      }\n    },\n    removeFromWishlistLocal(state, action) {\n      const {\n        id\n      } = action.payload || {};\n      if (id) {\n        state.items = state.items.filter(x => x !== id);\n      }\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(loadWishlist.fulfilled, (state, action) => {\n      state.items = Array.isArray(action.payload) ? action.payload : [];\n    });\n  }\n});\nexport const {\n  setWishlist,\n  addToWishlistLocal,\n  removeFromWishlistLocal\n} = wishlistSlice.actions;\nexport const addToWishlist = payload => async (dispatch, getState) => {\n  dispatch(addToWishlistLocal(payload));\n  try {\n    const userId = payload?.userId;\n    const key = `@elearning_wishlist_${userId || 'guest'}`;\n    const {\n      items\n    } = getState().wishlist;\n    await AsyncStorage.setItem(key, JSON.stringify(items));\n  } catch (e) {\n    if (__DEV__) console.warn('Failed to persist wishlist (add):', e);\n  }\n};\nexport const removeFromWishlist = payload => async (dispatch, getState) => {\n  dispatch(removeFromWishlistLocal(payload));\n  try {\n    const userId = payload?.userId;\n    const key = `@elearning_wishlist_${userId || 'guest'}`;\n    const {\n      items\n    } = getState().wishlist;\n    await AsyncStorage.setItem(key, JSON.stringify(items));\n  } catch (e) {\n    if (__DEV__) console.warn('Failed to persist wishlist (remove):', e);\n  }\n};\nexport default wishlistSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","AsyncStorage","loadWishlist","userId","key","raw","getItem","JSON","parse","e","wishlistSlice","name","initialState","items","reducers","setWishlist","state","action","payload","addToWishlistLocal","id","includes","push","removeFromWishlistLocal","filter","x","extraReducers","builder","addCase","fulfilled","Array","isArray","actions","addToWishlist","dispatch","getState","wishlist","setItem","stringify","__DEV__","console","warn","removeFromWishlist","reducer"],"sources":["/Users/mahmoudessam/Desktop/Qotoz/native-progect/e-learning-native/src/store/slices/wishlistSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\n\nexport const loadWishlist = createAsyncThunk('wishlist/load', async (userId) => {\n  try {\n    const key = `@elearning_wishlist_${userId || 'guest'}`;\n    const raw = await AsyncStorage.getItem(key);\n    return raw ? JSON.parse(raw) : [];\n  } catch (e) {\n    return [];\n  }\n});\n\n// Removed side-effects from reducers. Persistence is handled by thunks below.\n\nconst wishlistSlice = createSlice({\n  name: 'wishlist',\n  initialState: { items: [] },\n  reducers: {\n    setWishlist(state, action) {\n      state.items = action.payload || [];\n    },\n    // Pure reducers (no I/O)\n    addToWishlistLocal(state, action) {\n      const { id } = action.payload || {};\n      if (id && !state.items.includes(id)) {\n        state.items.push(id);\n      }\n    },\n    removeFromWishlistLocal(state, action) {\n      const { id } = action.payload || {};\n      if (id) {\n        state.items = state.items.filter((x) => x !== id);\n      }\n    },\n  },\n  extraReducers: (builder) => {\n    builder.addCase(loadWishlist.fulfilled, (state, action) => {\n      state.items = Array.isArray(action.payload) ? action.payload : [];\n    });\n  },\n});\n\nexport const { setWishlist, addToWishlistLocal, removeFromWishlistLocal } = wishlistSlice.actions;\n\n// Thunks that keep reducers pure and persist to AsyncStorage\nexport const addToWishlist = (payload) => async (dispatch, getState) => {\n  dispatch(addToWishlistLocal(payload));\n  try {\n    const userId = payload?.userId;\n    const key = `@elearning_wishlist_${userId || 'guest'}`;\n    const { items } = getState().wishlist;\n    await AsyncStorage.setItem(key, JSON.stringify(items));\n  } catch (e) {\n    if (__DEV__) console.warn('Failed to persist wishlist (add):', e);\n  }\n};\n\nexport const removeFromWishlist = (payload) => async (dispatch, getState) => {\n  dispatch(removeFromWishlistLocal(payload));\n  try {\n    const userId = payload?.userId;\n    const key = `@elearning_wishlist_${userId || 'guest'}`;\n    const { items } = getState().wishlist;\n    await AsyncStorage.setItem(key, JSON.stringify(items));\n  } catch (e) {\n    if (__DEV__) console.warn('Failed to persist wishlist (remove):', e);\n  }\n};\n\nexport default wishlistSlice.reducer;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}